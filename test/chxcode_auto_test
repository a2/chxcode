# shellcheck shell=sh

. ./share/chxcode/auto
. ./test/helper

test_auto_loaded_in_zsh() {
  [ -n "$ZSH_VERSION" ] || return

  assertEquals "chxcode_auto" "${preexec_functions:?}"
}

test_auto_load_is_idempotent_in_zsh() {
  [ -n "$ZSH_VERSION" ] || return

  . ./share/chxcode/auto

  assertNotEquals "should not add chxcode twice" \
    "${preexec_functions:?}" \
    "chxcode_auto chxcode_auto"
}

test_auto_loaded_in_bash() {
  [ -n "$BASH_VERSION" ] || return

  command=". $PWD/share/chxcode/auto && trap -p DEBUG"
  output="$("$SHELL" -c "$command")"

  assertTrue "did not add a trap hook for chxcode_auto" \
    "$(echo "$output" | grep ".*chxcode_auto.*")"
}

# shellcheck source=/dev/null
SHUNIT_PARENT=$0 . $SHUNIT2
